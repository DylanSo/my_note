# 8086汇编

## 配置环境

DosBox+masm工具集

​				1、创建一个用于保存汇编工具（如MASM、Link、DEBUG等工具）和汇编文件（*.asm）的目录，如：D:\DEBUG。(实际会用到的有以下程序：debug.exe edit.com link.exe masm.exe )

​				2、下载并安装DOSBox后打开程序，会出现如图所示的两个界面，　　　

<img src="https://img.jbzj.com/file_images/article/202001/2020011413283540.png" style="zoom:60%;" />

***



​					只需关心下图所示界面，另外一个界面无需关注，可以最小化但是不能关闭它。　　

<img src="https://img.jbzj.com/file_images/article/202001/2020011413283541.png" style="zoom:80%;" />



***

​		4、在上面选中界面依次输入以下命令(命令行不区分大小写)：

​		**第一步**：MOUNT C D:\DEBUG（回车）(	将目录 D:\DEBUG 挂载为DOSBOX下的 C:	)

​		<u>*PS:这里 D:\DEBUG 是之前创建的工作目录，根据自己的目录输入*</u>

　　**第二步**：C:（回车）(进入挂载后的C盘)

***



​																前两步执行结果如下图

<img src="https://img.jbzj.com/file_images/article/202001/2020011413283542.png" style="zoom:80%;" />

　　　　这样我们就进入了DOS的环境，可以编写汇编程序了。

　　　　为了避免每一次进入界面都要输入上面的命令,我们可以进行下面的简单配置，使得以后使用时可以直接进入我们想要的目录。

　　　　 打开C:\Users\Administrator\AppData\Local\DOSBox\dosbox-0.74.conf

![image-20201213094459866](https://img-blog.csdnimg.cn/img_convert/744def9805efc8390dc3574fb24b91fa.png)

　　　　在文件末尾添加以下内容：　　　　　　

```
	MOUNT C D:\DEBUG 
	C:
```

　　　　		再次运行DOSBox时就可以看到直接进入了下图所示界面

　　　<img src="https://img.jbzj.com/file_images/article/202001/2020011413283543.png" style="zoom:80%;" />

### 如何编译运行

​						在挂载处编写代码

​						打开dosbox 输入masm test.txt

<img src="https://oscimg.oschina.net/oscnet/8ce2aa15c457bf80225ed95633ef652396b.png" style="zoom:80%;" />

​						在0 severe errors的情况下会在挂载处生成TEST.OBJ

​						接着输入link TEST.OBJ

<img src="https://oscimg.oschina.net/oscnet/9cbbcff95c67d12fab290ad6b845cea57c7.png" style="zoom:80%;" />

​						此时生成TEST.exe

​						输入debug TEST.exe

​						用r命令查看寄存器，用t命令单步运行

![img](https://images2018.cnblogs.com/blog/1215297/201804/1215297-20180429142644926-708904364.png)

​						寄存器ax的值由FFFF变为5

​						对应着mov ax，5

​						完毕

***



## 一、基础知识

### 汇编语言组成

+ 汇编指令：机器码助记符,有对应机器码	(如1000100111011000	对应	mov ax,bx)
+ 伪指令：无对应机器码，由编译器执行，计算机不执行
+ 其他符号：其他符号(+-*/)，由编译器识别，无对应机器码

  > 一样的机器码可以对应数据或指令（看应用场景）

### 名词

* **储存单元**：从0开始编码，线性排列，一字节一单元

* **总线宽度**：每条线以高电平和低电平表示0或1，宽度为10代表10条线，能传输2^10(1024)种数据，宽度代表能力(寻址能力，控制能力，数据传输量)

* **主板**：板上集成了各种器件(**CPU，储存器，外围芯片组，拓展插槽**等)，通过总线连接，槽上一般有**RAM内存**和**各类接口卡**

* **接口卡**：CPU直接控制接口卡，接口卡对外设进行控制，从而CPU间接控制外设

* **各类储存器芯片**：

![image-20210327000019017](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210327000019017.png)

* **随机存储器**	RAM(Random Access Memory)

  ​		存放供CPU使用的数据和程序

  ​		显卡上叫显存，将要显示的内容写入显存

* **只读存储器**	ROM(Read-Only Memory)

  ​		只能读，不能写的内存，一般装有BIOS(Basic Input Output System)

### CPU对储存的应用

![image-20210326234930582](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210326234930582.png)

* **寻址**

  ​	通过地址总线

* **控制**

  ​	通过控制总线

* **数据传递**

  ​	通过数据总线

### 内存地址空间

![image-20210327000944283](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210327000944283.png)

​								所有的物理存储器被看作一个由若干存储单元组成的逻辑存储器

​															每个存储器都有相应的地址空间

![image-20210327001535868](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210327001535868.png)

## 二、寄存器

### 前置知识

![image-20210328222655237](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210328222655237.png)

### 名词

* **寄存器**：CPU中程序员可以用指令读写的部件
  * **通用寄存器**：存放一般性的数据
  * **段寄存器**：存放段地址
* 

### 通用寄存器

包含AX(AH、AL)、BX(BH、BL)、CX(CH、CL)、DX(DH、DL)

![image-20210328222142484](file://C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20210328222142484.png?lastModify=1616941298)

---

储存特性：

![image-20210328222335356](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210328222335356.png)

![image-20210328222619651](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210328222619651.png)

AH：高位字节	AL：低位字节

AH(byte)+AL(byte)=字(word)

---

### 几条汇编指令

![image-20210328222834165](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210328222834165.png)

PS：当寄存器中计算进位溢出时，最高位丢失(非真正丢失)

![image-20210328223213153](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210328223213153.png)

![image-20210328223229037](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210328223229037.png)

---

操作对象：

![image-20210328223345799](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210328223345799.png)

---

### 物理地址

8086CPU是**16位**CPU，有下列特性：

* 运算器一次最多可以处理16位的数据
* 寄存器的最大宽度为16位
* 寄存器和运算器之间的通路为16位

即能够 **一次性处理、运输、暂时存储** 的信息最长是16位的。

#### 8086CPU给出物理地址的方法

8086地址总线宽度为20，达1MB寻址能力，一次却只能送出16位地址(64KB寻址能力)

所以8086采用**两个16位地址合成**的方法形成一个20位的物理地址

![image-20210328224615220](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210328224615220.png)

---

算法：**物理地址=段地址X16+偏移地址**

![image-20210328224747267](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210328224747267.png)

---

### 段

**单个寄存器**或**多个寄存器合为一组**都可以作为**一段**

![image-20210328225209697](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210328225209697.png)

16位地址的寻址能力为64KB，所以一个段的长度**最大**为64KB

### 段寄存器

CS、DS、SS、ES	

CS(**代码段寄存器**)和IP(**指令指针寄存器**)是8086CPU中最关键的两个寄存器

即任意时刻，8086CPU将CS:IP指向的内容当做**指令**进行

---

指令实现过程：

![image-20210328231049147](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210328231049147.png)

![image-20210328231120027](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210328231120027.png)

![image-20210328231140327](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210328231140327.png)

![image-20210328231158611](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210328231158611.png)

---

开机启动指令：

![image-20210328231254142](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210328231254142.png)

> 最后三张图特别注意：

![image-20210328232757893](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210328232757893.png)

---

### 修改CS、IP的指令

程序员通过改变CS、IP中的内容来控制CPU执行目标指令

“mov”指令可修改**大部分**中的内容，被称为**传送指令**，却**不能**修改CS、IP中的内容(8086没有提供这样的功能)

能够改变CS、IP内容的指令被称为**转移指令**

​			“jmp”为一转移指令

![image-20210328232026296](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210328232026296.png)

​			也可以

![image-20210328232051913](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210328232051913.png)

### 代码段

存放指令代码的内存被称为代码段

将CS：IP指向代码段中第一条指令的首地址，以执行代码

如：一段代码存在123B0H~123B9H中，令CS=123BH、IP=0000H

## 寄存器(内存访问)

